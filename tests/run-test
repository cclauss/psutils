#!/bin/bash
# Run a psutils test

set -e

# Test files are checked in to avoid problems with changes in a2ps
# Uncomment the last two lines of the function to regenerate the files
function generate_input() {
    local paper=$1
    local pages=$2
    shift 2
    #testname=$(basename $(dirname $0))
    #../../mktestfile "$paper" "$pages" "$testname" > input.ps
}

function do_test() {
    eval "$@" input.ps > output.ps 2> stderr.txt
}

function custom_input_test() {
    do_test "$@"
    diff -u --ignore-matching-lines="^\(% \)\?%%CreationDate" expected.ps output.ps
}

# Arguments are command to run
function test() {
    generate_input "$1" "$2"
    shift 2
    custom_input_test "$@"
}

function no_output_test() {
    generate_input "$1" "$2"
    shift 2
    do_test "$@"
}

source test.sh
